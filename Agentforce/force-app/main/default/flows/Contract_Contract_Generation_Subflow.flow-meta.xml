<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>63.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>assignOLIs</name>
        <label>Assign OLI to Contract Line Item variable</label>
        <locationX>600</locationX>
        <locationY>1430</locationY>
        <assignmentItems>
            <assignToReference>contractLineItems.Account__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loopOLI.Opportunity.AccountId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>contractLineItems.GM_Percentage__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loopOLI.Gross_Percentage__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>contractLineItems.Product__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loopOLI.Product2.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>contractLineItems.Contract__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>contractID</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>contractLineItems.Sales_Price__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loopOLI.UnitPrice</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>contractLineItems.List_Price__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loopOLI.ListPrice</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>contractLineItems.CurrencyIsoCode</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loopOLI.CurrencyIsoCode</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>contractLineItems.Line_Description__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loopOLI.Description</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>contractLineItems.Product_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loopOLI.Product2.Name</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>contractLineItems.Subcontracted_Services__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loopOLI.Subcontracted_Services__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>contractLineItems.Owner__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loopOLI.Owner__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>contractLineItems.Start_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loopOLI.Opportunity.Contract_Start_Date__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>contractLineItems.Value__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>loopOLI.TotalPrice</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>contractLineItems.Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Formula_CLI_Status</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>contractOLI</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>contractOLI</name>
        <label>Contract CLI Collection Assignment</label>
        <locationX>600</locationX>
        <locationY>1538</locationY>
        <assignmentItems>
            <assignToReference>collectionContractOLI</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>contractLineItems</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>loopOLI</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Contract_ID_Create_Variable</name>
        <label>Set Contract ID Variable (Create)</label>
        <locationX>50</locationX>
        <locationY>890</locationY>
        <assignmentItems>
            <assignToReference>contractID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vOut_Created_Contract.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>loopOLI</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Contract_Id_Update_Variable</name>
        <label>Set Contract ID Variable (Update)</label>
        <locationX>974</locationX>
        <locationY>566</locationY>
        <assignmentItems>
            <assignToReference>contractID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Contract__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Contract_Latest_Won_Opp</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Set Variable values for Contract Creation</description>
        <name>Set_Contract_Variables</name>
        <label>Set Contract Variables</label>
        <locationX>50</locationX>
        <locationY>566</locationY>
        <assignmentItems>
            <assignToReference>vOut_Created_Contract.Account__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.AccountId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>vOut_Created_Contract.Budget_Annual_Value__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Annual_Contractual_Revenue__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>vOut_Created_Contract.Budget_GM_Percent__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.AnnualContractualGMPercentage__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>vOut_Created_Contract.Contract_End_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Contract_End_Date__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>vOut_Created_Contract.Contract_Start_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Contract_Start_Date__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>vOut_Created_Contract.Contract_Last_Renewed__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Contract_Start_Date__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>vOut_Created_Contract.CurrencyIsoCode</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.CurrencyIsoCode</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>vOut_Created_Contract.Description__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Description</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>vOut_Created_Contract.Key_Contact__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Primary_Contact__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>vOut_Created_Contract.Managing_Agent__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Managing_Agent__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>vOut_Created_Contract.Opportunity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>vOut_Created_Contract.Original_Opportunity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>f_Contract_OriginalOpportunity</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>vOut_Created_Contract.OwnerId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.OwnerId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>vOut_Created_Contract.Budget_Gross_Margin__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Annual_Contractual_GM__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Contract_Status_Subflow</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Output_Contract_Var</name>
        <label>Set Output Contract Var</label>
        <locationX>248</locationX>
        <locationY>2618</locationY>
        <assignmentItems>
            <assignToReference>vOut_Created_Contract</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Contract</elementReference>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <description>To be passed back to the triggering Flow.</description>
        <name>Update_Contract_Info_on_Opp_Variable</name>
        <label>Update Contract Info on Opp Variable</label>
        <locationX>512</locationX>
        <locationY>1838</locationY>
        <assignmentItems>
            <assignToReference>vInOut_Opportunity_Record.Contract__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>contractID</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Contract_Info_on_Opp</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Automation_Enabled</name>
        <label>Automation Enabled?</label>
        <locationX>2211</locationX>
        <locationY>134</locationY>
        <defaultConnectorLabel>No - Stop</defaultConnectorLabel>
        <rules>
            <name>Automation_Enabled_Outcome</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Setup.OCS_Config_Settings_CSH__c.Flows_Disabled__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Setup.OCS_Config_Settings_CSH__c.Migration_Flows_Enabled__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Contractual_Opp_Lines</targetReference>
            </connector>
            <label>Automation Enabled</label>
        </rules>
    </decisions>
    <decisions>
        <description>If Contract just created in this Flow then set Budget Annual Value, Budget Gross Margin and Budget GM%.
If Contract updated (not Created) then these values set via Scheduled Contract Flow.</description>
        <name>Contract_Created_Decision</name>
        <label>Contract Created?</label>
        <locationX>512</locationX>
        <locationY>2402</locationY>
        <defaultConnectorLabel>Not Created - Skip</defaultConnectorLabel>
        <rules>
            <name>Contract_Created_Continue</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Create_Contract</leftValueReference>
                <operator>WasVisited</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Contract</targetReference>
            </connector>
            <label>Contract Created - Continue</label>
        </rules>
    </decisions>
    <decisions>
        <description>For Facilities UK/IRE Opps where the Opp Contract Terms fields have been populated create a Terms record against the Contract if Terms don&apos;t already exist, otherwise update Contract Terms record. If a Contract Terms record already exists then update the values on this.</description>
        <name>Create_Update_Contract_Terms_Yes_No_Decision</name>
        <label>Create/Update Contract Terms?</label>
        <locationX>512</locationX>
        <locationY>2054</locationY>
        <defaultConnector>
            <targetReference>Contract_Created_Decision</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes_Create_Update_Contract_Terms_Outcome</name>
            <conditionLogic>(1 OR 2) AND 3 AND 4</conditionLogic>
            <conditions>
                <leftValueReference>vInOut_Opportunity_Record.Owner_Country__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>United Kingdom</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>vInOut_Opportunity_Record.Owner_Country__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Ireland</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>vInOut_Opportunity_Record.Corporate_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Facilities</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>vInOut_Opportunity_Record.Contract_Terms_Exist__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Update_Contract_Terms</targetReference>
            </connector>
            <label>Yes - Create/Update Terms</label>
        </rules>
    </decisions>
    <decisions>
        <name>noContractsLinked</name>
        <label>No Contracts Linked to Opp?</label>
        <locationX>512</locationX>
        <locationY>458</locationY>
        <defaultConnector>
            <targetReference>Set_Contract_Id_Update_Variable</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Contract Linked</defaultConnectorLabel>
        <rules>
            <name>noContractLinked</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>vInOut_Opportunity_Record.Contract__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_Contract_Variables</targetReference>
            </connector>
            <label>No Contract Linked</label>
        </rules>
    </decisions>
    <decisions>
        <name>oliNull</name>
        <label>Line Items Exist?</label>
        <locationX>1469</locationX>
        <locationY>350</locationY>
        <defaultConnectorLabel>No Line Items</defaultConnectorLabel>
        <rules>
            <name>noNull</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Contractual_Opp_Lines</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>noContractsLinked</targetReference>
            </connector>
            <label>Line Items Exist</label>
        </rules>
    </decisions>
    <decisions>
        <description>Is the Opportunity a Rebid or an Extension?</description>
        <name>Opp_is_Rebid_or_Ext</name>
        <label>Opp is a Rebid or Ext?</label>
        <locationX>974</locationX>
        <locationY>782</locationY>
        <defaultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Create_Update_Contract_Terms_Yes_No_Decision</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes_Rebid</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>vInOut_Opportunity_Record.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Rebid</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>vInOut_Opportunity_Record.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Extension</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Schedule_existing_CLI_for_termination</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <description>Subflow used to handle Contract creation and Contract Renewal - triggered from Opportunity: After Create and Update record triggered flow. Adds Contract Terms when Contract Created</description>
    <environments>Default</environments>
    <formulas>
        <description>Formula to return the Original Opportunity value to be used when creating a Contract upon win.
If Original Opp lookup is populated then use this, otherwise return the current Opp ID.</description>
        <name>f_Contract_OriginalOpportunity</name>
        <dataType>String</dataType>
        <expression>IF(ISBLANK({!vInOut_Opportunity_Record.Original_Opportunity__c}),{!vInOut_Opportunity_Record.Id},{!vInOut_Opportunity_Record.Original_Opportunity__c})</expression>
    </formulas>
    <formulas>
        <description>Set Contract Line Item Status Active or Pending depending on Contract Start Date</description>
        <name>Formula_CLI_Status</name>
        <dataType>String</dataType>
        <expression>IF({!vInOut_Opportunity_Record.Contract_Start_Date__c} &gt; {!$Flow.CurrentDate}, &quot;Pending&quot;, &quot;Active&quot;)</expression>
    </formulas>
    <interviewLabel>Contract: Contract Generation Subflow {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Contract: Contract Generation Subflow</label>
    <loops>
        <name>loopOLI</name>
        <label>loopOLI</label>
        <locationX>512</locationX>
        <locationY>1322</locationY>
        <collectionReference>Get_Contractual_Opp_Lines</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>assignOLIs</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>createContractOLIs</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_Contract</name>
        <label>Create Contract</label>
        <locationX>50</locationX>
        <locationY>782</locationY>
        <connector>
            <targetReference>Set_Contract_ID_Create_Variable</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <inputReference>vOut_Created_Contract</inputReference>
    </recordCreates>
    <recordCreates>
        <description>Create Contract Terms, or update Contract Terms record if one exists already.
NOTE: ID field on the vContract_Terms_Record var needs to be populated to check for existing record to allow update to work where required.</description>
        <name>Create_Update_Contract_Terms</name>
        <label>Create/Update Contract Terms</label>
        <locationX>248</locationX>
        <locationY>2162</locationY>
        <connector>
            <targetReference>Contract_Created_Decision</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Contract__r.Contract_Terms__c</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Annual_Price_Adjustment__c</field>
            <value>
                <elementReference>vInOut_Opportunity_Record.Annual_Price_Adjustment__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Bond_or_Third_Party_Guarantee__c</field>
            <value>
                <elementReference>vInOut_Opportunity_Record.Bond_or_Third_Party_Guarantee__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contract_Specification__c</field>
            <value>
                <elementReference>vInOut_Opportunity_Record.Contract_Specification__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contract__c</field>
            <value>
                <elementReference>contractID</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contractual_Non_Wage_Increase_Due_To_Law__c</field>
            <value>
                <elementReference>vInOut_Opportunity_Record.Contractual_Non_Wage_Increase_Due_To_Law__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contractual_Wage_Increase__c</field>
            <value>
                <elementReference>vInOut_Opportunity_Record.Contractual_Wage_Increase__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Is_Liability_Cap__c</field>
            <value>
                <elementReference>vInOut_Opportunity_Record.Liability_Cap__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Liability_Cap__c</field>
            <value>
                <elementReference>vInOut_Opportunity_Record.Liability_Cap_Value__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Parent_Guarantee__c</field>
            <value>
                <elementReference>vInOut_Opportunity_Record.Parent_Guarantee__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Payment_Terms__c</field>
            <value>
                <elementReference>vInOut_Opportunity_Record.PaymentTermsDays__c</elementReference>
            </value>
        </inputAssignments>
        <object>Contract_Terms__c</object>
        <operationMultMatchingRecords>UpdateLatestRecord</operationMultMatchingRecords>
        <operationOneMatchingRecord>UpdateAllRecords</operationOneMatchingRecord>
        <operationZeroMatchingRecords>AddRecord</operationZeroMatchingRecords>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <name>createContractOLIs</name>
        <label>Create Contract Line Items</label>
        <locationX>512</locationX>
        <locationY>1730</locationY>
        <connector>
            <targetReference>Update_Contract_Info_on_Opp_Variable</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <inputReference>collectionContractOLI</inputReference>
    </recordCreates>
    <recordLookups>
        <name>Get_Contract</name>
        <label>Get Contract</label>
        <locationX>248</locationX>
        <locationY>2510</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Set_Output_Contract_Var</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>contractID</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Contract__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Contractual_Opp_Lines</name>
        <label>Get Contractual Opp Lines</label>
        <locationX>1469</locationX>
        <locationY>242</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>oliNull</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>OpportunityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Service_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Contractual</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>OpportunityLineItem</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <description>Schedule existing Contract Line Items to terminate where Start Date has passed and is not terminated. To be replaced by new Contract Lines.</description>
        <name>Schedule_existing_CLI_for_termination</name>
        <label>Schedule existing CLI for termination</label>
        <locationX>578</locationX>
        <locationY>890</locationY>
        <connector>
            <targetReference>Update_Contract_Renewal_Info</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Contract__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Contract__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Line_Termination_Date__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Start_Date__c</field>
            <operator>LessThan</operator>
            <value>
                <elementReference>$Flow.CurrentDate</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Line_Termination_Date__c</field>
            <value>
                <elementReference>vInOut_Opportunity_Record.Contract__r.Contract_End_Date__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Marked_for_Termination_by_Renewal__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <object>Contract_Line_Item__c</object>
    </recordUpdates>
    <recordUpdates>
        <description>Populate Contract__c on Opp record with newly created Contract and Current Contract Value on Opp with Actual Annual Revenue from Contract.</description>
        <name>Update_Contract_Info_on_Opp</name>
        <label>Update Contract Info on Opp</label>
        <locationX>512</locationX>
        <locationY>1946</locationY>
        <connector>
            <targetReference>Create_Update_Contract_Terms_Yes_No_Decision</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Contract__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <elementReference>contractID</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Contract__c</field>
            <value>
                <elementReference>contractID</elementReference>
            </value>
        </inputAssignments>
        <object>Opportunity</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Contract_Latest_Won_Opp</name>
        <label>Update Contract Latest Won Opp</label>
        <locationX>974</locationX>
        <locationY>674</locationY>
        <connector>
            <targetReference>Opp_is_Rebid_or_Ext</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Contract__c</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Opportunity__c</field>
            <value>
                <elementReference>vInOut_Opportunity_Record.Id</elementReference>
            </value>
        </inputAssignments>
        <object>Contract__c</object>
    </recordUpdates>
    <recordUpdates>
        <description>Update the Contract End Date and the Last Renewed Date. Clear the value from the &apos;Renewal Opportunity&apos; field on Contract.</description>
        <name>Update_Contract_Renewal_Info</name>
        <label>Update Contract Renewal Info</label>
        <locationX>578</locationX>
        <locationY>998</locationY>
        <connector>
            <targetReference>loopOLI</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vInOut_Opportunity_Record.Contract__c</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Contract_End_Date__c</field>
            <value>
                <elementReference>vInOut_Opportunity_Record.Contract_End_Date__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contract_Last_Renewed__c</field>
            <value>
                <elementReference>vInOut_Opportunity_Record.Contract_Start_Date__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Rebid_Opportunity__c</field>
            <value>
                <stringValue></stringValue>
            </value>
        </inputAssignments>
        <object>Contract__c</object>
    </recordUpdates>
    <start>
        <locationX>2085</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Automation_Enabled</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <subflows>
        <name>Contract_Status_Subflow</name>
        <label>Contract Status Subflow</label>
        <locationX>50</locationX>
        <locationY>674</locationY>
        <connector>
            <targetReference>Create_Contract</targetReference>
        </connector>
        <flowName>Contract_Status_Subflow</flowName>
        <inputAssignments>
            <name>recordId</name>
            <value>
                <elementReference>vOut_Created_Contract</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>vOut_Created_Contract</assignToReference>
            <name>recordId</name>
        </outputAssignments>
    </subflows>
    <subflows>
        <name>Log_Error</name>
        <label>Log Error</label>
        <locationX>2690</locationX>
        <locationY>350</locationY>
        <flowName>Utility_Error_Log_Creation</flowName>
        <inputAssignments>
            <name>Level</name>
            <value>
                <stringValue>Error</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Messages</name>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>OriginName</name>
            <value>
                <stringValue>Contract: Contract Generation Subflow</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>RecordId</name>
            <value>
                <elementReference>vInOut_Opportunity_Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Type</name>
            <value>
                <stringValue>Flow</stringValue>
            </value>
        </inputAssignments>
    </subflows>
    <variables>
        <name>collectionContractOLI</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contract_Line_Item__c</objectType>
    </variables>
    <variables>
        <name>contractID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>contractLineItems</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contract_Line_Item__c</objectType>
    </variables>
    <variables>
        <name>vContract_Terms_Record</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contract_Terms__c</objectType>
    </variables>
    <variables>
        <name>vInOut_Opportunity_Record</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <name>vOut_Created_Contract</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <objectType>Contract__c</objectType>
    </variables>
</Flow>
