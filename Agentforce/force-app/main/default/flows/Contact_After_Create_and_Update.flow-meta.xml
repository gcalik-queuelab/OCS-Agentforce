<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>59.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Assign_and_add_to_Collection</name>
        <label>Assign and add to Collection</label>
        <locationX>864</locationX>
        <locationY>1463</locationY>
        <assignmentItems>
            <assignToReference>For_Each_Enquiry.Contact__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>v_enquiriesToUpdate</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>For_Each_Enquiry</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>For_Each_Enquiry</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_NPS_Status</name>
        <label>Assign NPS Status</label>
        <locationX>512</locationX>
        <locationY>3143</locationY>
        <assignmentItems>
            <assignToReference>v_NPSRecord.Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Closed</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>v_NPSRecord.Closed_Reason__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>No Response</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_NPS_Record</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_NPS_Status_Closed</name>
        <label>Assign NPS Status Closed</label>
        <locationX>50</locationX>
        <locationY>4835</locationY>
        <assignmentItems>
            <assignToReference>v_NPSRecord.Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Closed</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>v_NPSRecord.Reviewed__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>v_NPSRecord.Closed_Reason__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Received</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>v_NPSRecord.Survey_Received_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.CurrentDate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>v_NPSRecord.Survey_Received__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>v_NPSRecord.Recommend_Us_Score__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>f_score</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>v_NPSRecord.Comments__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Contact_NPS_Comments__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_NPS</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Assign Primary &amp; Secondary Source from Lead Source LinkedIn</description>
        <name>Assign_Primary_Secondary_Source</name>
        <label>Assign Primary &amp; Secondary Source</label>
        <locationX>1106</locationX>
        <locationY>755</locationY>
        <assignmentItems>
            <assignToReference>$Record.Primary_Source__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Sales</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Secondary_Source__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>LinkedIn</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Generated_or_Updated_Via_Lead_Conversion</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Campaign_Member_Status</name>
        <label>Set Campaign Member Status</label>
        <locationX>182</locationX>
        <locationY>5507</locationY>
        <assignmentItems>
            <assignToReference>v_campaignMember.Status</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Completed</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Campaign_Member</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Is_New</name>
        <label>Set Is New</label>
        <locationX>1392</locationX>
        <locationY>431</locationY>
        <assignmentItems>
            <assignToReference>v_isNew</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>f_isNew</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Create_or_Update</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_Campaign_Member_Status</name>
        <label>Update Campaign Member Status</label>
        <locationX>512</locationX>
        <locationY>3707</locationY>
        <assignmentItems>
            <assignToReference>v_campaignMember.Status</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Completed</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Campaign_Member_Record</targetReference>
        </connector>
    </assignments>
    <decisions>
        <description>Was the Campaign Member Record found? If so continue, otherwise Skip.</description>
        <name>Campaign_Member_Found_No_Response</name>
        <label>Campaign Member Found?</label>
        <locationX>776</locationX>
        <locationY>3599</locationY>
        <defaultConnector>
            <targetReference>Reset_Contact</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No - Skip</defaultConnectorLabel>
        <rules>
            <name>Yes_Campaign_Member_Found_No_Response</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>v_campaignMember.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Campaign_Member_Status</targetReference>
            </connector>
            <label>Yes - Campaign Member Found</label>
        </rules>
    </decisions>
    <decisions>
        <description>Was the Campaign Member Record found? If so continue, otherwise Skip.</description>
        <name>Campaign_Member_Found_Response_Received</name>
        <label>Campaign Member Found?</label>
        <locationX>446</locationX>
        <locationY>5399</locationY>
        <defaultConnector>
            <targetReference>Reset_Contact_Record</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No - Skip</defaultConnectorLabel>
        <rules>
            <name>Yes_Campaign_Member_Found_Response_Received_Outcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>v_campaignMember.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_Campaign_Member_Status</targetReference>
            </connector>
            <label>Yes - Campaign Member Found</label>
        </rules>
    </decisions>
    <decisions>
        <name>Create_Enquiry_Record</name>
        <label>Create Enquiry Record?</label>
        <locationX>1392</locationX>
        <locationY>1979</locationY>
        <defaultConnector>
            <targetReference>NPS_Checkbox_Checked</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Create_Enquiry</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Create_New_Enquiry__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CreateEnquiryRecord</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>Create Enquiry</label>
        </rules>
    </decisions>
    <decisions>
        <name>Create_or_Update</name>
        <label>Create or Update?</label>
        <locationX>1392</locationX>
        <locationY>539</locationY>
        <defaultConnector>
            <targetReference>Generated_or_Updated_Via_Lead_Conversion</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Update</defaultConnectorLabel>
        <rules>
            <name>Create</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>v_isNew</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Created_from_LinkedIn_Sales_Navigator</targetReference>
            </connector>
            <label>Create</label>
        </rules>
    </decisions>
    <decisions>
        <description>Assigned Primary &amp; Secondary Source post creation</description>
        <name>Created_from_LinkedIn_Sales_Navigator</name>
        <label>Created from LinkedIn Sales Navigator</label>
        <locationX>1238</locationX>
        <locationY>647</locationY>
        <defaultConnector>
            <targetReference>Generated_or_Updated_Via_Lead_Conversion</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Lead_Source_LinkedIn_Sales_Navigator</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.LeadSource</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>LinkedIn Sales Navigator</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Lead_ID__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Primary_Secondary_Source</targetReference>
            </connector>
            <label>Lead Source = LinkedIn Sales Navigator</label>
        </rules>
    </decisions>
    <decisions>
        <name>Delete_Contact</name>
        <label>Delete Contact?</label>
        <locationX>1392</locationX>
        <locationY>6095</locationY>
        <defaultConnector>
            <targetReference>Email_Opt_Out_Changed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Delete</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.TH_Consent_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Delete</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Delete_Contact_Record</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>Delete</label>
        </rules>
    </decisions>
    <decisions>
        <name>Email_Opt_Out_Changed</name>
        <label>Email Opt Out Changed</label>
        <locationX>1854</locationX>
        <locationY>6203</locationY>
        <defaultConnectorLabel>Not Changed</defaultConnectorLabel>
        <rules>
            <name>Email_Opt_Out_Is_Changed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.HasOptedOutOfEmail</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Opt_Out_Date</targetReference>
            </connector>
            <label>Email Opt Out Is Changed</label>
        </rules>
    </decisions>
    <decisions>
        <name>Enquiries_Found</name>
        <label>Enquiries Found?</label>
        <locationX>1040</locationX>
        <locationY>1247</locationY>
        <defaultConnector>
            <targetReference>Create_Enquiry_Record</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Enquiries_Retrieved</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_all_Enquiries</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>For_Each_Enquiry</targetReference>
            </connector>
            <label>Enquiries Retrieved</label>
        </rules>
    </decisions>
    <decisions>
        <description>If a Contact is either generated or updated via Lead Conversion, we need to retrieve all previously created enquiries and map them over to the contact.</description>
        <name>Generated_or_Updated_Via_Lead_Conversion</name>
        <label>Generated or Updated Via Lead Conversion</label>
        <locationX>1392</locationX>
        <locationY>1031</locationY>
        <defaultConnector>
            <targetReference>Create_Enquiry_Record</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Converted_via_Lead</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Lead_ID__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_all_Enquiries</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>Converted via Lead</label>
        </rules>
    </decisions>
    <decisions>
        <name>No_Response</name>
        <label>No Response?</label>
        <locationX>1392</locationX>
        <locationY>2819</locationY>
        <defaultConnector>
            <targetReference>Response_Received</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>No_Response_Given</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Contact_NPS_No_Response__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_NPS</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>No Response Given</label>
        </rules>
    </decisions>
    <decisions>
        <name>NPS_Checkbox_Checked</name>
        <label>NPS Checkbox Checked?</label>
        <locationX>1392</locationX>
        <locationY>2519</locationY>
        <defaultConnector>
            <targetReference>No_Response</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Create_New_NPS</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Marketing_triggered_contact_NPS__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Contact_NPS</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>Create New NPS</label>
        </rules>
    </decisions>
    <decisions>
        <description>Was an NPS Record found? If not Skip.</description>
        <name>NPS_Found_No_Response</name>
        <label>NPS Found?</label>
        <locationX>776</locationX>
        <locationY>3035</locationY>
        <defaultConnector>
            <targetReference>Get_Campaign_Member</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No - Skip</defaultConnectorLabel>
        <rules>
            <name>Yes_NPS_Found_No_Response</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>v_NPSRecord.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_NPS_Status</targetReference>
            </connector>
            <label>Yes - NPS Found</label>
        </rules>
    </decisions>
    <decisions>
        <description>Was an NPS Record found? If not Skip.</description>
        <name>NPS_Found_Response_Received</name>
        <label>NPS Found?</label>
        <locationX>446</locationX>
        <locationY>4727</locationY>
        <defaultConnector>
            <targetReference>Get_Campaign_Member_Record</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No - Skip</defaultConnectorLabel>
        <rules>
            <name>Yes_NPS_Found_Response_Received_Outcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>v_NPSRecord.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_NPS_Status_Closed</targetReference>
            </connector>
            <label>Yes - NPS Found</label>
        </rules>
    </decisions>
    <decisions>
        <description>When Contact NPS Response is received from Pardot create Perception History, Update Relationship Score field, create NPS Response and Close NPS. Also update Campaign Member Status and reset their Contact NPS Received back to False for next time.</description>
        <name>Response_Received</name>
        <label>Response Received</label>
        <locationX>1392</locationX>
        <locationY>4295</locationY>
        <defaultConnector>
            <targetReference>Delete_Contact</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No - Skip</defaultConnectorLabel>
        <rules>
            <name>Response_Received_from_Contact</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Contact_NPS_received__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Perception_History</targetReference>
            </connector>
            <label>Response Received from Contact</label>
        </rules>
    </decisions>
    <decisions>
        <name>Validate_Config_Switch</name>
        <label>Validate Config Switch</label>
        <locationX>1953</locationX>
        <locationY>323</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Automation_Enabled</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Setup.OCS_Config_Settings_CSH__c.Flows_Disabled__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Setup.OCS_Config_Settings_CSH__c.Migration_Flows_Enabled__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_Is_New</targetReference>
            </connector>
            <label>Automation Enabled</label>
        </rules>
    </decisions>
    <description>AD-967 - After create and update flow for Contact object</description>
    <environments>Default</environments>
    <formulas>
        <name>f_isNew</name>
        <dataType>Boolean</dataType>
        <expression>IF({!$Setup.OCS_Config_Settings_CSH__c.Migration_Flows_Enabled__c}, {!$Setup.OCS_Config_Settings_CSH__c.Migration_Flows_Enabled__c}, ISNEW())</expression>
    </formulas>
    <formulas>
        <description>Convert Would You Recommend Us (1-10) to Perception (Promoter/Passive/Detractor).</description>
        <name>f_RecommendUs_Perception_Conversion</name>
        <dataType>String</dataType>
        <expression>CASE(TEXT({!$Record.Would_you_recommend_us__c}),
&quot;10&quot;, &quot;Promoter&quot;,
&quot;9&quot;,&quot;Promoter&quot;,
&quot;8&quot;,&quot;Passive&quot;,
&quot;7&quot;,&quot;Detractor&quot;,
&quot;6&quot;,&quot;Detractor&quot;,
&quot;5&quot;,&quot;Detractor&quot;,
&quot;4&quot;,&quot;Detractor&quot;,
&quot;3&quot;,&quot;Detractor&quot;,
&quot;2&quot;,&quot;Detractor&quot;,
&quot;1&quot;,&quot;Detractor&quot;,
NULL
)</expression>
    </formulas>
    <formulas>
        <name>f_score</name>
        <dataType>Number</dataType>
        <expression>VALUE(TEXT({!$Record.Would_you_recommend_us__c}))</expression>
        <scale>2</scale>
    </formulas>
    <interviewLabel>Contact: After Create and Update {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Contact: After Create and Update</label>
    <loops>
        <name>For_Each_Enquiry</name>
        <label>For Each Enquiry</label>
        <locationX>776</locationX>
        <locationY>1355</locationY>
        <collectionReference>Get_all_Enquiries</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_and_add_to_Collection</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_Enquiry_Records</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_NPS_Response</name>
        <label>Create NPS Response</label>
        <locationX>50</locationX>
        <locationY>5051</locationY>
        <connector>
            <targetReference>Get_Campaign_Member_Record</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>Answer__c</field>
            <value>
                <elementReference>$Record.Contact_NPS_Comments__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Generate_Action_Plan__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>NPS__c</field>
            <value>
                <elementReference>v_NPSRecord.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Name</field>
            <value>
                <stringValue>Would you recommend us?</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Question__c</field>
            <value>
                <stringValue>Would you recommend us?</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Score__c</field>
            <value>
                <elementReference>f_score</elementReference>
            </value>
        </inputAssignments>
        <object>NPS_Response__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <name>Create_Perception_History</name>
        <label>Create Perception History</label>
        <locationX>446</locationX>
        <locationY>4403</locationY>
        <connector>
            <targetReference>Update_Relationship_Score</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>Contact__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Date__c</field>
            <value>
                <elementReference>$Record.Contact_NPS_Received_Date__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Perception__c</field>
            <value>
                <elementReference>f_RecommendUs_Perception_Conversion</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Source__c</field>
            <value>
                <stringValue>Customer</stringValue>
            </value>
        </inputAssignments>
        <object>Perception_History__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <name>CreateEnquiryRecord</name>
        <label>Create Enquiry Record</label>
        <locationX>996</locationX>
        <locationY>2087</locationY>
        <connector>
            <targetReference>Update_Contact</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>Campaign__c</field>
            <value>
                <elementReference>$Record.pi__campaign__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contact__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Corporate_Type__c</field>
            <value>
                <elementReference>$Record.Corporate_Type__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Country__c</field>
            <value>
                <elementReference>$Record.MailingCountry</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Description__c</field>
            <value>
                <elementReference>$Record.Enquiry_Description__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Enquiry_Service__c</field>
            <value>
                <elementReference>$Record.Enquiry_Service__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>$Record.OwnerId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Service_Required__c</field>
            <value>
                <elementReference>$Record.Primary_Service__c</elementReference>
            </value>
        </inputAssignments>
        <object>Enquiry__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordDeletes>
        <name>Delete_Contact_Record</name>
        <label>Delete Contact Record</label>
        <locationX>930</locationX>
        <locationY>6203</locationY>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <inputReference>$Record</inputReference>
    </recordDeletes>
    <recordLookups>
        <name>Get_all_Enquiries</name>
        <label>Get all Enquiries</label>
        <locationX>1040</locationX>
        <locationY>1139</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Enquiries_Found</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Lead__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Lead_ID__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Enquiry__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Campaign_Member</name>
        <label>Get Campaign Member</label>
        <locationX>776</locationX>
        <locationY>3491</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Campaign_Member_Found_No_Response</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ContactId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>NPS_Campaign__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>CampaignMember</object>
        <outputReference>v_campaignMember</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Status</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Campaign_Member_Record</name>
        <label>Get Campaign Member Record</label>
        <locationX>446</locationX>
        <locationY>5291</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Campaign_Member_Found_Response_Received</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ContactId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>NPS_Campaign__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>CampaignMember</object>
        <outputReference>v_campaignMember</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Status</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_NPS</name>
        <label>Get NPS</label>
        <locationX>776</locationX>
        <locationY>2927</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>NPS_Found_No_Response</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>NPS_Contact__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <object>NPS__c</object>
        <outputReference>v_NPSRecord</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Status__c</queriedFields>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_NPS_Response</name>
        <label>Get NPS Record</label>
        <locationX>446</locationX>
        <locationY>4619</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>NPS_Found_Response_Received</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>NPS_Contact__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <object>NPS__c</object>
        <outputReference>v_NPSRecord</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Status__c</queriedFields>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
    </recordLookups>
    <recordUpdates>
        <name>Remove_Opt_Out_Date</name>
        <label>Remove Opt Out Date</label>
        <locationX>1458</locationX>
        <locationY>6419</locationY>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>HasOptedOutOfEmail</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <inputAssignments>
            <field>Opted_Out_Date__c</field>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Reset_Contact</name>
        <label>Reset Contact</label>
        <locationX>776</locationX>
        <locationY>4055</locationY>
        <connector>
            <targetReference>Response_Received</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Contact_NPS_No_Response__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <object>Contact</object>
    </recordUpdates>
    <recordUpdates>
        <name>Reset_Contact_Record</name>
        <label>Reset Contact Record</label>
        <locationX>446</locationX>
        <locationY>5855</locationY>
        <connector>
            <targetReference>Delete_Contact</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>Contact_NPS_received__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Campaign_Member</name>
        <label>Update Campaign Member</label>
        <locationX>182</locationX>
        <locationY>5615</locationY>
        <connector>
            <targetReference>Reset_Contact_Record</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <inputReference>v_campaignMember</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Campaign_Member_Record</name>
        <label>Update Campaign Member Record</label>
        <locationX>512</locationX>
        <locationY>3815</locationY>
        <connector>
            <targetReference>Reset_Contact</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <inputReference>v_campaignMember</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Contact</name>
        <label>Update Contact</label>
        <locationX>996</locationX>
        <locationY>2195</locationY>
        <connector>
            <targetReference>NPS_Checkbox_Checked</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>Create_New_Enquiry__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Enquiry__c</field>
            <value>
                <elementReference>CreateEnquiryRecord</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Enquiry_Records</name>
        <label>Update Enquiry Records</label>
        <locationX>776</locationX>
        <locationY>1655</locationY>
        <connector>
            <targetReference>Create_Enquiry_Record</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <inputReference>v_enquiriesToUpdate</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_NPS</name>
        <label>Update NPS</label>
        <locationX>50</locationX>
        <locationY>4943</locationY>
        <connector>
            <targetReference>Create_NPS_Response</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <inputReference>v_NPSRecord</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_NPS_Record</name>
        <label>Update NPS Record</label>
        <locationX>512</locationX>
        <locationY>3251</locationY>
        <connector>
            <targetReference>Get_Campaign_Member</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <inputReference>v_NPSRecord</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Opt_Out_Date</name>
        <label>Update Opt Out Date</label>
        <locationX>1458</locationX>
        <locationY>6311</locationY>
        <connector>
            <targetReference>Remove_Opt_Out_Date</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>HasOptedOutOfEmail</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <inputAssignments>
            <field>Opted_Out_Date__c</field>
            <value>
                <elementReference>$Flow.CurrentDate</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <description>Update Relationship Score with converted value from Would You Recommend Us</description>
        <name>Update_Relationship_Score</name>
        <label>Update Relationship Score</label>
        <locationX>446</locationX>
        <locationY>4511</locationY>
        <connector>
            <targetReference>Get_NPS_Response</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Log_Error</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>Relationship_Score__c</field>
            <value>
                <elementReference>f_RecommendUs_Perception_Conversion</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>1827</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Validate_Config_Switch</targetReference>
        </connector>
        <object>Contact</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <subflows>
        <name>Create_Contact_NPS</name>
        <label>Create Contact NPS</label>
        <locationX>1260</locationX>
        <locationY>2627</locationY>
        <connector>
            <targetReference>No_Response</targetReference>
        </connector>
        <flowName>Create_Contact_NPS_Subflow</flowName>
        <inputAssignments>
            <name>contactRecord</name>
            <value>
                <elementReference>$Record</elementReference>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <subflows>
        <name>Log_Error</name>
        <label>Log Error</label>
        <locationX>1524</locationX>
        <locationY>2195</locationY>
        <flowName>Utility_Error_Log_Creation</flowName>
        <inputAssignments>
            <name>Level</name>
            <value>
                <stringValue>Error</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Messages</name>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>OriginName</name>
            <value>
                <stringValue>Contact: After Create and Update</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>RecordId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Type</name>
            <value>
                <stringValue>Flow</stringValue>
            </value>
        </inputAssignments>
    </subflows>
    <variables>
        <name>v_campaignMember</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CampaignMember</objectType>
    </variables>
    <variables>
        <name>v_enquiriesToUpdate</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Enquiry__c</objectType>
    </variables>
    <variables>
        <name>v_isNew</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>v_NPSRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>NPS__c</objectType>
    </variables>
</Flow>
