<?xml version="1.0" encoding="UTF-8"?>
<ValidationRule xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Lock_Closed_Opps_After_90_Days</fullName>
    <active>false</active>
    <description>Lock Closed Won, Lost, Withdrawn Opportunities 90 days after their close date. Allow edits by Admins or changes to Opp Name - required for Account Name changes.</description>
    <errorConditionFormula>AND(
/* Bypass if Custom Setting for Validation Rules is disabled */
$Setup.OCS_Config_Settings_CSH__c.Validation_Rules_Disabled__c = FALSE,
				
/* Bypass if the user has got one the following permissions */
$Permission.System_Administrator = FALSE,
$Permission.Regional_Delegated_Administrator = FALSE,
$Permission.Delegated_Admin = FALSE,
$Permission.Country_Delegated_Administrator = FALSE,
				
/* Bypass if Opportunity Record Type is Target */
RecordType.DeveloperName != &quot;Target&quot;,

/* Opp Record Lock formula field ticks when record should be locked after 90 Days.
			Also used as criteria for showing a message component for User */				
Opportunity_Record_Lock__c = TRUE,
NOT(ISCHANGED(Name)),/* Allow change to Opp Name post closure */
NOT(ISCHANGED(No_of_Debriefs__c)),/* Allow for no of Debriefs to be added post closure */
NOT(ISCHANGED(No_of_Incumbents__c)),/* Allow No of Incumbents to be adjusted post closure */
NOT(ISCHANGED(Incumbent__c)), /* Allow Incumbent to be added post closure */
NOT(ISCHANGED(Competitor__c)), /* Allow Competitor to be added post closure */
NOT(ISCHANGED(Competitor_Assigned__c)), /* Allow Competitor Assigned to be added post closure - Formula? */
NOT(ISCHANGED(Sub_Stage__c)),/* TO CHECK - Not sure this is right */
NOT(ISCHANGED(StageName)),/* TO CHECK - Not sure this is right */
NOT(ISCHANGED(Closed_Reason__c)),/* Allow change of Closed Reason */
NOT(ISCHANGED(Closed_Further_Details__c)),/* Allow updates to Closed Further Details post closure */
NOT(ISCHANGED(PaymentTermsDays__c)), /* Allow Payment Terms and Contract Specification fields for Contract Terms to be backfilled retrospectively*/
NOT(ISCHANGED(Contract_Specification__c)), /* Review for deletion as part of Contract Terms */
NOT(ISCHANGED(Contract__c)), /* Allow for Contract to be changed */
NOT(ISCHANGED(PMO_Support__c))/* Allow for backfill of PMO Support */
)</errorConditionFormula>
    <errorMessage>More than 90 Days have passed since this Closed Opportunity&apos;s Award Date and so it has been locked.
If you need changed to be made then please contact your local Administrator.</errorMessage>
</ValidationRule>
